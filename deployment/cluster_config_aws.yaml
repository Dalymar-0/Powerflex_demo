# PowerFlex Cluster Configuration - AWS EC2 Deployment
# For cloud deployment with AWS

cluster:
  name: "powerflex-demo-aws"
  # Generate with: python -c "import secrets; print(secrets.token_hex(32))"
  cluster_secret: "CHANGE_ME_GENERATE_NEW_SECRET"
  python_path: "/usr/bin/python3"
  project_root: "/opt/powerflex"

# AWS VPC: 10.0.0.0/16
# Subnet: 10.0.1.0/24

mdm:
  hostname: "ip-10-0-1-10"
  ip: "10.0.1.10"
  public_ip: "FILL_AFTER_EC2_CREATION"  # For SSH access
  port: 8001
  ssh_user: "ubuntu"
  ssh_port: 22
  ssh_key: "~/.ssh/powerflex-aws.pem"  # Your AWS key pair

sds_nodes:
  - name: "sds1"
    hostname: "ip-10-0-1-11"
    ip: "10.0.1.11"
    public_ip: "FILL_AFTER_EC2_CREATION"
    ssh_user: "ubuntu"
    ssh_port: 22
    ssh_key: "~/.ssh/powerflex-aws.pem"
    sds_id: 1
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds1"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"
    
  - name: "sds2"
    hostname: "ip-10-0-1-12"
    ip: "10.0.1.12"
    public_ip: "FILL_AFTER_EC2_CREATION"
    ssh_user: "ubuntu"
    ssh_port: 22
    ssh_key: "~/.ssh/powerflex-aws.pem"
    sds_id: 2
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds2"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"

sdc_nodes:
  - name: "sdc1"
    hostname: "ip-10-0-1-13"
    ip: "10.0.1.13"
    public_ip: "FILL_AFTER_EC2_CREATION"
    ssh_user: "ubuntu"
    ssh_port: 22
    ssh_key: "~/.ssh/powerflex-aws.pem"
    sdc_id: 1
    nbd_port: 8005
    control_port: 8003
    mgmt_port: 8004

mgmt:
  hostname: "ip-10-0-1-10"
  ip: "10.0.1.10"
  public_ip: "FILL_AFTER_EC2_CREATION"
  port: 5000
  ssh_user: "ubuntu"
  ssh_port: 22
  ssh_key: "~/.ssh/powerflex-aws.pem"

network:
  vpc_cidr: "10.0.0.0/16"
  subnet_cidr: "10.0.1.0/24"
  mdm_ports: [8001]
  sds_ports: [9100, 9200, 9700]
  sdc_ports: [8003, 8004, 8005]
  mgmt_ports: [5000]
  max_rtt_ms: 100  # AWS inter-AZ latency
  heartbeat_interval: 10

# AWS-specific settings
aws:
  region: "us-east-1"
  ami: "ami-0c7217cdde317cfec"  # Ubuntu 22.04 LTS (us-east-1)
  instance_types:
    mdm: "t3.medium"    # 2 vCPU, 4GB RAM
    sds: "t3.small"     # 2 vCPU, 2GB RAM  
    sdc: "t3.micro"     # 2 vCPU, 1GB RAM
  storage:
    mdm_disk: 50        # GB
    sds_disk: 120       # GB
    sdc_disk: 30        # GB
  vpc_id: "FILL_AFTER_VPC_CREATION"
  subnet_id: "FILL_AFTER_SUBNET_CREATION"
  security_group_id: "FILL_AFTER_SG_CREATION"
  key_pair_name: "powerflex-demo"

deployment:
  install_deps: true
  python_packages:
    - fastapi==0.128.5
    - uvicorn==0.40.0
    - flask==3.1.2
    - sqlalchemy==2.0.46
    - pydantic==2.12.5
    - requests==2.32.5
    - bcrypt==4.2.1
  system_packages:
    - python3-pip
    - python3-venv
    - git
    - sqlite3
  create_systemd: true
  enable_on_boot: true
  log_dir: "/var/log/powerflex"
  backup_dir: "/var/backups/powerflex"

tests:
  smoke_test: true
  integration_test: true
  failure_test: true
