# PowerFlex Cluster Configuration for Phase 14 Deployment
# Edit this file with your VM IP addresses and preferences

# Quick Setup Options:
#   VMware + Rocky Linux:  Use IPs 192.168.100.10-14 (see VMWARE_REDHAT_GUIDE.md)
#   VirtualBox + Ubuntu:   Use IPs 192.168.56.10-14 (see cluster_config_virtualbox.yaml)
#   AWS EC2:               Use IPs 10.0.1.10-14 (see cluster_config_aws.yaml)

cluster:
  name: "powerflex-demo"
  # Shared secret for component authentication
  # Generate with: python -c "import secrets; print(secrets.token_hex(32))"
  cluster_secret: "CHANGE_ME_GENERATE_NEW_SECRET"
  
  # Python interpreter path (adjust for your VMs)
  python_path: "/usr/bin/python3"
  project_root: "/opt/powerflex"

# MDM (Master Data Manager) - Control plane
mdm:
  hostname: "powerflex-mdm"
  ip: "192.168.100.10"  # VMware default, adjust for your setup
  port: 8001
  ssh_user: "rocky"  # 'ubuntu' for Ubuntu, 'rocky' for Rocky Linux
  ssh_port: 22

# SDS (ScaleIO Data Server) nodes - At least 2 for replication
sds_nodes:
  - name: "sds1"
    hostname: "powerflex-sds1"
    ip: "192.168.100.11"  # VMware default, adjust for your setup
    ssh_user: "rocky"
    ssh_port: 22
    sds_id: 1  # Will be assigned by MDM
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds1"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"
    
  - name: "sds2"
    hostname: "powerflex-sds2"
    ip: "192.168.100.12"  # VMware default, adjust for your setup
    ssh_user: "rocky"
    ssh_port: 22
    sds_id: 2
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds2"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"

# SDC (ScaleIO Data Client) nodes
sdc_nodes:
  - name: "sdc1"
    hostname: "powerflex-sdc1"
    ip: "192.168.100.13"  # VMware default, adjust for your setup
    ssh_user: "rocky"
    ssh_port: 22
    sdc_id: 1
    nbd_port: 8005
    control_port: 8003
    mgmt_port: 8004

# MGMT (Management GUI) - Co-located with MDM
mgmt:
  hostname: "powerflex-mdm"
  ip: "192.168.100.10"  # Same as MDM
  port: 5000
  ssh_user: "rocky"
  ssh_port: 22

# Network configuration
network:
  # Firewall ports to open
  mdm_ports: [8001]
  sds_ports: [9100, 9200, 9700]
  sdc_ports: [8003, 8004, 8005]
  mgmt_ports: [5000]
  
  # Latency thresholds for testing
  max_rtt_ms: 100  # Max acceptable round-trip time
  heartbeat_interval: 10  # Seconds between heartbeats

# Deployment preferences
deployment:
  # Install dependencies on remote VMs
  install_deps: true
  
  # Python packages to install
  python_packages:
    - fastapi==0.128.5
    - uvicorn==0.40.0
    - flask==3.1.2
    - sqlalchemy==2.0.46
    - pydantic==2.12.5
    - requests==2.32.5
    - bcrypt==4.2.1
  
  # System packages (Ubuntu/Debian)
  system_packages:
    - python3-pip
    - python3-venv
    - git
    - sqlite3
  
  # Create systemd services
  create_systemd: true
  
  # Enable services on boot
  enable_on_boot: true
  
  # Log directory
  log_dir: "/var/log/powerflex"
  
  # Backup directory
  backup_dir: "/var/backups/powerflex"

# Testing scenarios
tests:
  # Run after deployment
  smoke_test: true
  integration_test: true
  failure_test: false  # Set true to test component failures
  
  # Failure scenarios to test
  failure_scenarios:
    - sds1_network_partition  # Disconnect SDS1 from network
    - sds2_crash  # Kill SDS2 process
    - mdm_restart  # Restart MDM service
