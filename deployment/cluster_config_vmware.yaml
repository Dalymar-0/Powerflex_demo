# PowerFlex Cluster Configuration - VMware Workstation (RedHat)
# For local VM testing with VMware Workstation + Rocky Linux 9 / AlmaLinux 9

cluster:
  name: "powerflex-demo-vmware"
  # Generate with: python -c "import secrets; print(secrets.token_hex(32))"
  cluster_secret: "CHANGE_ME_GENERATE_NEW_SECRET"
  python_path: "/usr/bin/python3"
  project_root: "/opt/powerflex"

# VMware Workstation NAT Network: 192.168.100.0/24
# Or Host-Only VMnet1: 192.168.137.0/24
# Gateway: 192.168.100.2 (VMware NAT)

mdm:
  hostname: "powerflex-mdm"
  ip: "192.168.100.10"
  port: 8001
  ssh_user: "rocky"  # Or 'alma' for AlmaLinux, 'root' if you prefer
  ssh_port: 22

sds_nodes:
  - name: "sds1"
    hostname: "powerflex-sds1"
    ip: "192.168.100.11"
    ssh_user: "rocky"
    ssh_port: 22
    sds_id: 1
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds1"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"
    
  - name: "sds2"
    hostname: "powerflex-sds2"
    ip: "192.168.100.12"
    ssh_user: "rocky"
    ssh_port: 22
    sds_id: 2
    data_port: 9700
    control_port: 9100
    mgmt_port: 9200
    storage_root: "/var/powerflex/sds2"
    capacity_gb: 100
    devices: "blk0,blk1,blk2"

sdc_nodes:
  - name: "sdc1"
    hostname: "powerflex-sdc1"
    ip: "192.168.100.13"
    ssh_user: "rocky"
    ssh_port: 22
    sdc_id: 1
    nbd_port: 8005
    control_port: 8003
    mgmt_port: 8004
    
  - name: "sdc2"
    hostname: "powerflex-sdc2"
    ip: "192.168.100.14"
    ssh_user: "rocky"
    ssh_port: 22
    sdc_id: 2
    nbd_port: 8006  # Different port for 2nd SDC
    control_port: 8013
    mgmt_port: 8014

mgmt:
  hostname: "powerflex-mdm"
  ip: "192.168.100.10"  # Co-located with MDM
  port: 5000
  ssh_user: "rocky"
  ssh_port: 22

network:
  type: "vmware_nat"  # or "vmware_hostonly"
  subnet: "192.168.100.0/24"
  gateway: "192.168.100.2"
  dns: "192.168.100.2"
  mdm_ports: [8001]
  sds_ports: [9100, 9200, 9700]
  sdc_ports: [8003, 8004, 8005, 8013, 8014, 8006]
  mgmt_ports: [5000]
  max_rtt_ms: 50  # Local VMware network
  heartbeat_interval: 10

# RedHat-specific deployment settings
deployment:
  os_type: "rhel"  # rocky, alma, centos-stream, or rhel
  install_deps: true
  
  # Python packages (same as Ubuntu)
  python_packages:
    - fastapi==0.128.5
    - uvicorn==0.40.0
    - flask==3.1.2
    - sqlalchemy==2.0.46
    - pydantic==2.12.5
    - requests==2.32.5
    - bcrypt==4.2.1
  
  # RedHat-specific system packages (dnf/yum)
  system_packages:
    - python3.11  # Or python3.12 if available
    - python3-pip
    - git
    - sqlite
    - wget
    - curl
    - vim
    - net-tools
    - firewalld  # RedHat uses firewalld instead of ufw
  
  create_systemd: true
  enable_on_boot: true
  log_dir: "/var/log/powerflex"
  backup_dir: "/var/backups/powerflex"
  
  # SELinux handling (RedHat-specific)
  selinux_mode: "permissive"  # or "enforcing" with proper contexts

tests:
  smoke_test: true
  integration_test: true
  failure_test: false
  
  failure_scenarios:
    - sds1_network_partition
    - sds2_crash
    - mdm_restart
